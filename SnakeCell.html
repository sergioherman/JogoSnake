<!--
Implementar CSS com percentuais e remover estilo do Javascript    
fazer o placar
fazer as configurações
-->

<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snake</title>
</head>
<body>
    <div id = 'divglobal'>
        <div class = 'caixaexterna' id = 'cabecalho'>
            <div class = 'caixaexterna' id = 'config'></div>
            <div class = 'caixaexterna' id = 'titulo'><h1 id = 'tituloh1' >Snake</h1></div>
            <div class = 'caixaexterna' id = 'placar'></div>
        </div>
        <hr>
        <div class = 'caixaexterna' id = 'areaquadro'>
            <div id='quadro'></div>
            <div id='letreiro'> <p id='textodoletreiro'></p></div>
        </div>
        <div class = 'caixaexterna' id = 'controle'>
            <div class = 'caixaexterna' id = 'direcional'>
                <table id = 'tabeladirecional'>
                    <tr>
                        <td></td><td id='celulabotaocima'><input class = 'botaodirecional' id = 'botaocima' type="button" value='&#9650;' onmouseover="pegadirecao('cima')"></td><td></td>
                    </tr>
                    <tr>
                        <td id='celulabotaoesquerda'><input class = 'botaodirecional' id = 'botaoesq' type="button" value='&#9668;' onmouseover="pegadirecao('esquerda')"></td><td></td><td id='celulabotaodireita'><input class = 'botaodirecional' id = 'botaodir' type="button" value='&#9658;' onmouseover="pegadirecao('direita')"></td>
                    </tr>
                    <tr>
                        <td></td><td id='celulabotaobaixo'><input class = 'botaodirecional' id = 'botaobaixo' type="button" value='&#9660;' onmouseover="pegadirecao('baixo')"></td><td></td>
                    </tr>
                </table>
            </div>
            <div class = 'caixaexterna' id = 'acao'>
                <table id='tabelaacao'>
                    <tr>
                        <td id='celulabotaorestart'><input class='botaoacao' id='botaorestart' type="button" value='Restart' onclick="restart()"></td>
                    </tr>
                    <tr>
                        <td id='celulabotaopause'><input class='botaoacao' id='botaopause' type="button" value='Pause' onclick="pause()"></td>
                    </tr>
                    <tr>
                        <td id='celulabotaoacelera'><input class = 'botaoacao' id = 'botaoacelera' type="button" value='Acelera' onmouseover="acelera()" onmouseout="frea()"></td>
                    </tr>
                </table>
            </div>    
        </div>
    </div>
    <style>
        hr{
            margin: 0px;
        }
        .botaoacao{
            border-radius: 15px;
            font-family: 'Courier New', Courier, monospace;
            font-weight: 600;
            text-shadow: 3px 3px 5px rgba(0, 0, 0, 1);
        }
        #tabeladirecional{
            position: relative;
            top: 5%;
        }
        .botaodirecional{
            border-radius: 25%;
            text-shadow: 3px 3px 5px rgba(0, 0, 0, 1);
        }
        body{
            background-color: black;
            color: white;
        }
        #divglobal{
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%,-50%);
            margin: 0px;
            padding: 0px;
        }
        .caixaexterna{
            box-shadow:0px 0px 0px 5px rgba(110, 110, 110, 0.7) inset;
        }
        #titulo h1{
            margin: 0px;
            font-size: 18pt;
            text-align: center;
        }
        #quadro{
            margin: auto;
            width: fit-content; /* nao funciona no firefox*/
            width: -moz-fit-content;
            transform: translate(0px,5px);
            /* box-shadow:0px 0px 1px 1px rgba(255, 255, 255, 0.7) inset; */
        }
        .quadrinho{
            box-shadow:1px 2px 1px 0px rgba(255, 255, 255, 0.7) inset;
            border-radius: 20%;
        }
        td p {
            display: none;
        }
        #letreiro{
            position: relative;
            margin: auto;
            background-color: rgba(0, 0, 0, 0.7);
            border: white solid 2px;
            transform: rotate(-20deg);
            text-align: center;
            font-family: 'Courier New', Courier, monospace;
            width: fit-content;
            width: -moz-fit-content;
            padding: 20px;
        }
        #textodoletreiro{
            margin: auto;
            position: relative;
            top: 50%;
            transform: translate(0%,-50%);
            text-shadow: 7px 7px 2px rgba(0, 0, 0, 0.65);
            /* margin: auto; */
        }
    </style>
    
    <script>
        window.addEventListener("keydown",function(event){pegadirteclado(event.keyCode)})
        window.addEventListener("resize", function(){init()})
        window.addEventListener("resize", function(){drawmaca()})
        
        declaracaodevariaveis()
        init()
        
        updatemaca()
        drawmaca()

        document.getElementById('letreiro').style.display = 'block'
        document.getElementById('textodoletreiro').innerHTML = 'Start' 
        setTimeout (apagaletreiro,tempoinicial)
        
        delaydeinicio = setTimeout(run,tempoinicial)

        function apagaletreiro(){
            document.getElementById('letreiro').style.display='none'
        }

        function init(){
            tamanhodasareas()
            montaquadro()
            montabotoes() //pronto mas falta configurações e placar
            desenhacobrainteira()
        }     

        function desenhacobrainteira(){
            for(let nn=0; nn<tamc; nn++){
                if(cobra[nn][0]>0 && cobra[nn][0]<=tamx && cobra[nn][1] > 0 && cobra[nn][1] < tamy){
                    gomo = String(cobra[nn][0]) +'-'+ String(cobra[nn][1])
                    document.getElementById(gomo).style.backgroundColor= 'white'
                    document.getElementById(gomo).style.borderRadius='30%'
                }
            }
        }
        
        function run(){
            passo++
            temporizador = setTimeout(run,tempopasso)
            update()
            if (fimdojogo == false){
                drawgomo()
                drawmaca()    
            }
            erase()
            
            // document.getElementById('config').innerHTML=''
            // // document.getElementById('config').innerHTML+='Direção no fim do Run: ' +direcao+ '</br>'
            // document.getElementById('config').innerHTML+='Aponta atual: ' +apontaatual+'</br>'
            // document.getElementById('config').innerHTML+='Aponta proximo: ' +apontaproximo+'</br>'
            // document.getElementById('config').innerHTML+='Passo: no fim no Run '+passo +'</br>'
            // // document.getElementById('config').innerHTML+='Rabo: '+rabo +'</br>'
            // document.getElementById('config').innerHTML+='Nova Cobra: ['+cobra[0]+'],['+cobra[1]+'],['+cobra[2]+'],['+cobra[3]+']</br>'
            // document.getElementById('config').innerHTML+='Tamanho da Cobra Após Update>: '+tamc+'</br>'
            // document.getElementById('config').innerHTML+='Maçã: '+maca+'</br>'
            // document.getElementById('config').innerHTML+='Rabo: '+rabo+'</br>'

        }

        function declaracaodevariaveis(){
            document.getElementById('letreiro').style.display='none'
            passo=0
            tamx = 15 //parseInt(document.getElementById('btamx').value)
            tamy = 10 //parseInt(document.getElementById('btamy').value)
            cobra = [[1,2,1],[2,2,2],[3,2,0]]
            // cobra = [[1,2,1],[2,2,2],[3,2,3],[4,2,4],[5,2,0]]
            direcao = 'direita'
            tamc = cobra.length
            comeu = false
            apontaatual = cobra[(tamc-2)][2]
            apontaproximo = cobra[(tamc-1)][2]
            tempoinicial = 1000
            temponormal = 250
            tempoacelerado = temponormal*0.4
            tempopasso = temponormal
            fimdojogo = false
            rabo = rabo = String(cobra[apontaproximo][0]+'-'+cobra[apontaproximo][1])
            gomo = rabo
            paused = false
        }

        function tamanhodasareas(){
            indicereduçãox = 0.95
            indicereduçãoy = 0.9
            larguradajanela = window.innerWidth
            alturadajanela = window.innerHeight
            
            // Configura a Área do Cabeçalho
            var larguradocabecalho = larguradajanela*1*indicereduçãox
            var alturadocabecalho = alturadajanela*0.1*indicereduçãoy
            document.getElementById('cabecalho').style.width=larguradocabecalho+'px'
            document.getElementById('cabecalho').style.height=alturadocabecalho+'px'
            // document.getElementById('cabecalho').style.backgroundColor='blue'
            
            //Configura a Área de Configurações
            var larguradaconfig = larguradajanela*0.3*indicereduçãox
            var alturadaconfig = alturadajanela*0.1*indicereduçãoy
            document.getElementById('config').style.width=larguradaconfig+'px'
            document.getElementById('config').style.height=alturadaconfig+'px'
            // document.getElementById('config').style.backgroundColor='red'

            //Configura a Área do Título
            var larguradotitulo = larguradajanela*0.4*indicereduçãox
            var alturadotitulo = alturadajanela*0.1*indicereduçãoy
            document.getElementById('titulo').style.width=larguradotitulo+'px'
            document.getElementById('titulo').style.height=alturadotitulo+'px'
            document.getElementById('titulo').style.position='relative'
            document.getElementById('titulo').style.top='-'+alturadaconfig+'px'
            document.getElementById('titulo').style.left=larguradaconfig+'px'
            // document.getElementById('titulo').style.backgroundColor='gray'

            //Centralizando Verticalmente o Texto do Título
            var tamfontetitulo = alturadotitulo*0.55
            var deslocverttexttit = (alturadotitulo-tamfontetitulo)/2
            document.getElementById('tituloh1').style.fontSize=tamfontetitulo+'px'
            document.getElementById('tituloh1').style.transform='translate(0px,'+deslocverttexttit+'px)'

            //Configura a Área do Placar
            var larguradoplacar = larguradajanela*0.3*indicereduçãox
            var alturadoplacar = alturadajanela*0.1*indicereduçãoy
            document.getElementById('placar').style.width=larguradoplacar+'px'
            document.getElementById('placar').style.height=alturadoplacar+'px'
            document.getElementById('placar').style.position='relative'
            document.getElementById('placar').style.top='-'+(alturadaconfig+alturadoplacar)+'px'
            document.getElementById('placar').style.left=(larguradaconfig+larguradotitulo)+'px'
            // document.getElementById('placar').style.backgroundColor='orange'
            

            //Configura a Área do areaquadro
            larguraareaquadro = larguradajanela*1*indicereduçãox
            alturaareaquadro = alturadajanela*0.6*indicereduçãoy
            document.getElementById('areaquadro').style.width=larguraareaquadro+'px'
            document.getElementById('areaquadro').style.height=alturaareaquadro+'px'
            // document.getElementById('areaquadro').innerHTML=larguraareaquadro+' - '+alturaareaquadro
            // document.getElementById('areaquadro').style.backgroundColor='yellow'

            //Confugura Área do Letreiro
            // document.getElementById('letreiro').style.width=larguradotitulo+'px'
            document.getElementById('letreiro').style.height=alturadotitulo+'px'
            // document.getElementById('letreiro').style.position='relative'
            document.getElementById('letreiro').style.top='-'+alturaareaquadro/2+'px'
            document.getElementById('letreiro').style.fontSize=alturadotitulo*0.6+'px'
            // document.getElementById('letreiro').style.marginTop=alturadotitulo+'px'


            //Configura a Área do Controle
            var larguradocontrole = larguradajanela*1*indicereduçãox
            var alturadocontrole = alturadajanela*0.3*indicereduçãoy
            document.getElementById('controle').style.width=larguradocontrole+'px'
            document.getElementById('controle').style.height=alturadocontrole+'px'

            //Configura a Área do Direcional
            var larguradodirecional = larguradajanela*0.6*indicereduçãox
            var alturadodirecional = alturadajanela*0.3*indicereduçãoy
            document.getElementById('direcional').style.width=larguradodirecional+'px'
            document.getElementById('direcional').style.height=alturadodirecional+'px'
            // document.getElementById('direcional').style.backgroundColor='green'

            //Configura a Área de Ação
            var larguradaacao = larguradajanela*0.4*indicereduçãox
            var alturadaacao = alturadajanela*0.3*indicereduçãoy
            document.getElementById('acao').style.width=larguradaacao+'px'
            document.getElementById('acao').style.height=alturadaacao+'px'
            document.getElementById('acao').style.position='relative'
            document.getElementById('acao').style.top='-'+alturadodirecional+'px'
            document.getElementById('acao').style.left=larguradodirecional+'px'
            // document.getElementById('acao').style.backgroundColor='blue'       
        }

        function montaquadro(){
            var razaowidtamx = Number(larguraareaquadro/tamx)
            var razaoheitamy = Number(alturaareaquadro/tamy)
            if(razaoheitamy<razaowidtamx){menorrazao=razaoheitamy}
            else{menorrazao=razaowidtamx}
            tamq = parseInt(menorrazao)-5
            if (tamq > 50) {tamq = 50}
            texto='<table id = "tabela">'
            for(let nx=1;nx<=tamy;nx++){
                texto+='<tr id = linha'+nx+'>'
                for (let ny=1;ny<=tamx;ny++){
                    texto+='<td class="quadrinho" id = '+ny+'-'+nx+' name="quad" style="width: '+tamq+'px;height: '+tamq+'px;"><p>'+ny+'-'+nx+'</p></td>'}
                texto+='</tr>'
            }
            texto+='</table>'
            document.getElementById('quadro').innerHTML=texto
        }

        function montabotoes(){
            var indicereduçãox = 0.95
            var indicereduçãoy = 0.9
            var larguradajanela = window.innerWidth
            var alturadajanela = window.innerHeight
            var larguradodirecional = larguradajanela*0.6*indicereduçãox
            var alturadodirecional = alturadajanela*0.3*indicereduçãoy
            var redbotdirec=0.8
            document.getElementById('tabeladirecional').style.position='relative'
            if (larguradodirecional/alturadodirecional>=2){
                document.getElementById('botaocima').style.width=(redbotdirec*alturadodirecional*2/3)+'px'
                document.getElementById('botaocima').style.height=(redbotdirec*alturadodirecional/3)+'px'
                document.getElementById('botaobaixo').style.width=(redbotdirec*alturadodirecional*2/3)+'px'
                document.getElementById('botaobaixo').style.height=(redbotdirec*alturadodirecional/3)+'px'
                document.getElementById('botaodir').style.width=(redbotdirec*alturadodirecional*2/3)+'px'
                document.getElementById('botaodir').style.height=(redbotdirec*alturadodirecional/3)+'px'
                document.getElementById('botaoesq').style.width=(redbotdirec*alturadodirecional*2/3)+'px'
                document.getElementById('botaoesq').style.height=(redbotdirec*alturadodirecional/3)+'px'
                document.getElementById('tabeladirecional').style.height=alturadodirecional+'px'
                document.getElementById('tabeladirecional').style.width=(2*alturadodirecional)+'px'
                deslocdirecionalx=(larguradodirecional/2)-0.5*(2*alturadodirecional)
                document.getElementById('tabeladirecional').style.left=deslocdirecionalx+'px'
                tamfontedirec=redbotdirec*alturadodirecional*0.7/3
            }else{
                document.getElementById('botaocima').style.width=(redbotdirec*larguradodirecional/3)+'px'
                document.getElementById('botaocima').style.height=(redbotdirec*larguradodirecional/6)+'px'
                document.getElementById('botaobaixo').style.width=(redbotdirec*larguradodirecional/3)+'px'
                document.getElementById('botaobaixo').style.height=(redbotdirec*larguradodirecional/6)+'px'
                document.getElementById('botaodir').style.width=(redbotdirec*larguradodirecional/3)+'px'
                document.getElementById('botaodir').style.height=(redbotdirec*larguradodirecional/6)+'px'
                document.getElementById('botaoesq').style.width=(redbotdirec*larguradodirecional/3)+'px'
                document.getElementById('botaoesq').style.height=(redbotdirec*larguradodirecional/6)+'px'
                document.getElementById('tabeladirecional').style.width=larguradodirecional+'px'
                document.getElementById('tabeladirecional').style.height=(larguradodirecional/2)+'px'
                deslocdirecionaly=(alturadodirecional/2)-0.5*(larguradodirecional/2)
                document.getElementById('tabeladirecional').style.top=deslocdirecionaly+'px'
                tamfontedirec=redbotdirec*larguradodirecional*0.7/6
            }
            document.getElementById('botaocima').style.fontSize=tamfontedirec+'px'
            document.getElementById('botaodir').style.fontSize=tamfontedirec+'px'
            document.getElementById('botaobaixo').style.fontSize=tamfontedirec+'px'
            document.getElementById('botaoesq').style.fontSize=tamfontedirec+'px'

            var larguradaacao = larguradajanela*0.4*indicereduçãox
            var alturadaacao = alturadajanela*0.3*indicereduçãoy
            var redbotacao=0.9
            document.getElementById('botaorestart').style.width=(larguradaacao*redbotacao*0.8)+'px'
            document.getElementById('botaopause').style.width=(larguradaacao*redbotacao*0.8)+'px'
            document.getElementById('botaoacelera').style.width=(larguradaacao*redbotacao*0.8)+'px'
            document.getElementById('botaorestart').style.height=(alturadodirecional*redbotacao*0.25)+'px'
            document.getElementById('botaopause').style.height=(alturadaacao*redbotacao*0.25)+'px'
            document.getElementById('botaoacelera').style.height=(alturadaacao*redbotacao*0.4)+'px'
            document.getElementById('botaoacelera').style.marginTop=(alturadaacao*redbotacao*0.1)+'px'
            document.getElementById('tabelaacao').style.margin='auto'
            document.getElementById('botaorestart').style.fontSize=(alturadodirecional*redbotacao*0.25*0.45)+'px'
            document.getElementById('botaopause').style.fontSize=(alturadaacao*redbotacao*0.25*0.45)+'px'
            document.getElementById('botaoacelera').style.fontSize=(alturadaacao*redbotacao*0.25*0.45)+'px'
        }

        function update(){
            updatecobra()
            document.getElementById('config').innerHTML=''
            //Verifica se comeu a maçã
            if (String(cobra[apontaatual][0]) == String(maca[0]) && String(cobra[apontaatual][1]) == String(maca[1])) {
                updatemaca()
                aumentacobra()
            }
            //Verifico se bateu nela mesma
            estavaindopara=direcao
            for (let ii = 0; ii < tamc; ii++){
                if (ii != apontaatual){
                    if (String(cobra[apontaatual][0]) == String(cobra[ii][0]) && String(cobra[apontaatual][1]) == String(cobra[ii][1])) {
                    gameover()
                    }
                }
            }

            // Verifica se bateu na parede
            if (cobra[apontaatual][0]>tamx || cobra[apontaatual][1]<1 || cobra[apontaatual][1]>tamy || cobra[apontaatual][0]<1) { 
                gameover()      
            }
        }

        function updatecobra(){
            tamc=cobra.length
            rabo = String(cobra[apontaproximo][0]+'-'+cobra[apontaproximo][1])
            if (direcao == 'direita') {cobra[apontaproximo]=[cobra[apontaatual][0]+1,cobra[apontaatual][1],cobra[apontaproximo][2]]}
            if (direcao == 'esquerda') {cobra[apontaproximo]=[cobra[apontaatual][0]-1,cobra[apontaatual][1],cobra[apontaproximo][2]]}
            if (direcao == 'cima') {cobra[apontaproximo]=[cobra[apontaatual][0],cobra[apontaatual][1]-1,cobra[apontaproximo][2]]}
            if (direcao == 'baixo') {cobra[apontaproximo]=[cobra[apontaatual][0],cobra[apontaatual][1]+1,cobra[apontaproximo][2]]}
            gomo = String(cobra[apontaproximo][0]+'-'+cobra[apontaproximo][1])
            
            apontaproximo = cobra[apontaproximo][2]
            apontaatual = cobra[apontaatual][2]

        }

        function updatemaca(){
            maca = [parseInt(1+(tamx*Math.random())),parseInt(1+(tamy*Math.random()))]
            var mudadenovo = true
            while (mudadenovo){
                mudadenovo = false
                for (let mm = 0; mm < tamc; mm++){
                    if (String(cobra[mm][0])+','+String(cobra[mm][1]) == String(maca)){
                        maca = [parseInt(1+(tamx*Math.random())),parseInt(1+(tamy*Math.random()))]
                        mudadenovo = true
                    }
                }
            }
            vermelho = String(maca[0]) +'-'+ String(maca[1])
        }

        function aumentacobra(){
            cobra[tamc] = [cobra[apontaproximo][0],cobra[apontaproximo][1]]
            cobra[tamc][2]=cobra[apontaatual][2]
            cobra[apontaatual][2]=tamc
            apontaproximo=tamc
        }

        function drawmaca(){
            document.getElementById(vermelho).style.backgroundColor= 'red'
            document.getElementById(vermelho).style.borderRadius='50%'
            document.getElementById(vermelho).style.boxShadow='0px 0px 5px 2px rgba(255, 200, 0, 0.5) inset'
        }
        function drawgomo(){
            document.getElementById(gomo).style.backgroundColor= 'white'
            document.getElementById(gomo).style.borderRadius='30%'
        }
        
        function erase(){
            document.getElementById(rabo).style.backgroundColor= 'black'
            document.getElementById(rabo).style.borderRadius='20%'
            document.getElementById(rabo).style.boxShadow='1px 2px 1px 0px rgba(255, 255, 255, 0.7) inset'
        }

        function gameover(){
            document.getElementById('placar').innerHTML='BATEU!'
            clearTimeout(temporizador)
            fimdojogo = true
            document.getElementById('textodoletreiro').innerHTML='Game Over'
            document.getElementById('letreiro').style.display='block'
        }

        function restart(){
            clearTimeout(delaydeinicio)
            clearTimeout(temporizador)

            declaracaodevariaveis()
            init()
        
            updatemaca()
            document.getElementById(vermelho).style.backgroundColor= 'red'
        
            document.getElementById('letreiro').style.display = 'block'
            document.getElementById('textodoletreiro').innerHTML = 'Start' 
            setTimeout (apagaletreiro,tempoinicial)
        
            delaydeinicio = setTimeout(run,tempoinicial)

        }

        function pegadirecao(botaoapertado){
            if ((estavaindopara == 'baixo' && botaoapertado == 'cima')||
                (estavaindopara == 'cima' && botaoapertado == 'baixo')||
                (estavaindopara == 'esquerda' && botaoapertado == 'direita')||
                (estavaindopara == 'direita' && botaoapertado == 'esquerda')){}
            else{direcao=botaoapertado}
        }

        function pegadirteclado(codigotecla){
            // alert(codigodatecla)
            if ((codigotecla == 37 || codigotecla == 65) && (estavaindopara != 'direita')&&(estavaindopara != 'esquerda')) {direcao = 'esquerda'}
            if ((codigotecla == 38 || codigotecla == 87) && (estavaindopara != 'baixo')&&(estavaindopara != 'cima')) {direcao = 'cima'}
            if ((codigotecla == 39 || codigotecla == 68) && (estavaindopara != 'esquerda')&&(estavaindopara != 'direita')) {direcao = 'direita'}
            if ((codigotecla == 40 || codigotecla == 83) && (estavaindopara != 'cima')&&(estavaindopara != 'baixo')) {direcao = 'baixo'}

            if (codigotecla == 80){pause()}
            if(codigotecla==82) {restart()}

            if(codigotecla==88) {tempopasso = tempoacelerado}
            if(codigotecla==90) {tempopasso = temponormal}
            // if(tecla==67) {
            //     epraacelerar=true
            //     primeiropassoac = true
            // }
        }

        function pause(){
            if (fimdojogo == false){
                if (paused == false){
                    paused = true
                    document.getElementById('textodoletreiro').innerHTML='Paused'
                    document.getElementById('letreiro').style.display='block'
                    clearTimeout(temporizador)
                
                } else {
                    paused = false
                    document.getElementById('letreiro').style.display='none'
                    setTimeout(run,tempopasso)
                }
            }
        }
    
        function acelera(){
            tempopasso = tempoacelerado
        }

        function frea(){
            tempopasso = temponormal
        }

</script>
</body>
</html>